<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vedic Astrology South Indian Chart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --dark-bg: #121212;
            --darker-bg: #0a0a0a;
            --chart-bg: #1a1a1a;
            --box-bg: #242424;
            --border-color: #333;
            --light-border: #444;
            --text-color: #e0e0e0;
            --light-text: #bdbdbd;
            --accent-color: #64b5f6;
            --accent-hover: #90caf9;
            --highlight-color: #ffcc80;
            --tooltip-bg: rgba(51, 51, 51, 0.95);
            --panel-bg: rgba(42, 42, 42, 0.95);
            --success-color: #81c784;
            --shadow: 0 2px 8px rgba(0,0,0,0.5);
            --transition: all 0.3s ease;
            --mobile-font-size: 14px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, -apple-system, sans-serif;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            padding: 12px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: var(--mobile-font-size);
            line-height: 1.4;
        }

        .app-container {
            width: 100%;
            max-width: 100%;
        }

        .chart-title {
            text-align: center;
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--highlight-color);
            padding: 0 5px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }

        /* Mobile-first chart grid */
        .chart-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, minmax(70px, 1fr));
            gap: 1px;
            width: 100%;
            aspect-ratio: 1 / 1;
            max-width: 100vw;
            margin: 0 auto;
            border: 1px solid var(--light-border);
            box-shadow: var(--shadow);
            background-color: var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            grid-template-areas:
                "pisces aries taurus gemini"
                "aquarius center center cancer"
                "capricorn center center leo"
                "sagittarius scorpio libra virgo";
        }

        .chart-box {
            border: 1px solid var(--border-color);
            position: relative;
            background-color: var(--box-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            text-align: center;
            padding: 3px;
            overflow: hidden;
        }

        .chart-box[data-sign="Pisces"] { grid-area: pisces; }
        .chart-box[data-sign="Aries"] { grid-area: aries; }
        .chart-box[data-sign="Taurus"] { grid-area: taurus; }
        .chart-box[data-sign="Gemini"] { grid-area: gemini; }
        .chart-box[data-sign="Aquarius"] { grid-area: aquarius; }
        .chart-box[data-sign="Cancer"] { grid-area: cancer; }
        .chart-box[data-sign="Capricorn"] { grid-area: capricorn; }
        .chart-box[data-sign="Leo"] { grid-area: leo; }
        .chart-box[data-sign="Sagittarius"] { grid-area: sagittarius; }
        .chart-box[data-sign="Scorpio"] { grid-area: scorpio; }
        .chart-box[data-sign="Libra"] { grid-area: libra; }
        .chart-box[data-sign="Virgo"] { grid-area: virgo; }

        #central-empty-space {
            grid-area: center;
            background-color: var(--chart-bg);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 3px;
            padding: 5px;
        }

        .center-label {
            color: var(--light-text);
            font-size: 0.8em;
            text-align: center;
        }

        .sign-label {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 0.75em;
            color: var(--highlight-color);
            font-weight: 600;
            padding: 2px 4px;
            border-radius: 3px;
            background-color: rgba(0,0,0,0.3);
            z-index: 1;
        }

        .house-label {
            position: absolute;
            bottom: 2px;
            right: 2px;
            font-size: 0.8em;
            color: var(--accent-color);
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
            background-color: rgba(0,0,0,0.3);
            z-index: 1;
        }

        .planet {
            cursor: pointer;
            margin: 2px;
            font-size: 0.85em;
            padding: 4px 6px;
            border-radius: 4px;
            display: flex;
            flex-direction: row;
            align-items: center;
            white-space: nowrap;
            user-select: none;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
            position: relative;
            color: var(--dark-bg);
            font-weight: 500;
            min-width: 0;
            justify-content: center;
            z-index: 2;
            touch-action: none;
            min-height: 28px;
        }

        .planet-symbol {
            font-weight: bold;
            font-size: 0.9em;
            margin-right: 2px;
        }

        .planet-degree-display {
            font-size: 0.7em;
            color: var(--dark-bg);
            margin-left: 3px;
            opacity: 0.9;
        }

        .Lagna {
            background-color: transparent;
            border: 1.5px solid #ffb300;
            color: var(--highlight-color);
            font-weight: bold;
        }

        .planet:active {
            transform: scale(0.95);
        }

        .planet.highlighted {
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 0 0 2px var(--accent-color);
        }

        .Sun { background-color: #ffd700; }
        .Moon { background-color: #e0e0e0; }
        .Mars { background-color: #ff5252; }
        .Mercury { background-color: #00e676; }
        .Jupiter { background-color: #ffb300; }
        .Venus { background-color: #e91e63; }
        .Saturn { background-color: #7986cb; }
        .Rahu { background-color: #9e9e9e; }
        .Ketu { background-color: #616161; }

        .planets-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            justify-content: center;
            align-items: flex-start;
            width: 100%;
            height: auto;
            overflow-y: auto;
            padding: 2px;
            align-content: flex-start;
            min-height: 28px;
        }

        .chart-box.drag-over {
            background-color: rgba(100, 181, 246, 0.1);
            border: 1px dashed var(--accent-color);
        }

        #planet-bank.drag-over {
            background-color: rgba(100, 181, 246, 0.1);
            border: 1px dashed var(--accent-color);
        }

        .controls-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            margin: 0 auto;
        }

        .controls {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--darker-bg);
            box-shadow: var(--shadow);
        }

        .controls-section {
            margin-bottom: 12px;
        }

        .controls-title {
            font-size: 1em;
            margin-bottom: 8px;
            color: var(--highlight-color);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .controls-title i {
            font-size: 1.1em;
        }

        button {
            padding: 8px 12px;
            font-size: 0.9em;
            margin: 4px 2px;
            border-radius: 5px;
            border: 1px solid var(--accent-color);
            background-color: rgba(100, 181, 246, 0.1);
            color: var(--accent-color);
            cursor: pointer;
            font-weight: 500;
            min-height: 36px;
        }

        button:active {
            background-color: var(--accent-color);
            color: var(--dark-bg);
            transform: translateY(1px);
        }

        button.secondary {
            border-color: var(--light-text);
            color: var(--light-text);
            background-color: rgba(189, 189, 189, 0.1);
        }

        button.secondary:active {
            background-color: var(--light-text);
            color: var(--dark-bg);
        }

        button.success {
            border-color: var(--success-color);
            color: var(--success-color);
            background-color: rgba(129, 199, 132, 0.1);
        }

        button.success:active {
            background-color: var(--success-color);
            color: var(--dark-bg);
        }

        #planet-bank {
            border: 1px dashed var(--light-border);
            padding: 8px;
            min-height: 44px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            background-color: var(--darker-bg);
            border-radius: 6px;
        }

        .tooltip {
            position: fixed;
            background-color: var(--tooltip-bg);
            color: var(--text-color);
            padding: 10px 12px;
            border-radius: 5px;
            font-size: 0.85em;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            box-shadow: var(--shadow);
            text-align: left;
            line-height: 1.4;
            max-width: 280px;
            border: 1px solid var(--light-border);
        }
        
        .tooltip.active {
            opacity: 1;
        }
        
        .tooltip strong {
            color: var(--highlight-color);
            font-weight: 600;
        }
        
        .tooltip span {
            display: block;
            margin-bottom: 2px;
        }
        
        .tooltip hr {
            border: none;
            border-top: 1px solid var(--light-border);
            margin: 6px 0;
        }

        #retrograde-panel {
            position: fixed;
            background-color: var(--panel-bg);
            border: 1px solid var(--accent-color);
            border-radius: 6px;
            padding: 12px;
            box-shadow: var(--shadow);
            z-index: 101;
            display: none;
            flex-direction: column;
            gap: 8px;
            width: 85%;
            max-width: 300px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        
        #retrograde-panel.active {
            display: flex;
        }
        
        #retrograde-panel label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: var(--text-color);
            font-size: 0.95em;
        }
        
        #retrograde-panel input[type="checkbox"] {
            transform: scale(1.2);
            cursor: pointer;
            accent-color: var(--accent-color);
        }
        
        #retrograde-panel .panel-planet-name {
            font-weight: bold;
            color: var(--highlight-color);
            font-size: 1em;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--light-border);
        }

        .planet.retrograde .retrograde-symbol {
            font-size: 0.75em;
            color: #ff5252;
            font-weight: bold;
            margin-left: 2px;
            vertical-align: super;
        }
        
        #language-selector {
            padding: 5px 8px;
            border-radius: 5px;
            border: 1px solid var(--accent-color);
            background-color: var(--darker-bg);
            color: var(--text-color);
            margin-left: 8px;
            cursor: pointer;
            font-size: 0.85em;
        }
        
        .controls-tip {
            font-weight: 500;
            color: var(--highlight-color);
            margin-top: 6px;
            font-size: 0.85em;
            line-height: 1.3;
            padding: 6px;
            background-color: rgba(255, 204, 128, 0.1);
            border-radius: 5px;
            border-left: 2px solid var(--highlight-color);
        }

        .hidden {
            display: none !important;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
            margin-top: 8px;
        }

        /* Prompt Generation Styles */
        #prompt-container {
            display: none;
            margin-top: 15px;
            width: 100%;
        }

        #prompt-container.active {
            display: block;
        }

        #ai-prompt {
            width: 100%;
            height: 150px;
            background-color: var(--darker-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            font-family: system-ui, -apple-system, sans-serif;
            font-size: 0.9em;
            line-height: 1.4;
            resize: none;
            margin-bottom: 8px;
        }

        #copy-prompt-btn {
            display: block;
            width: 100%;
            padding: 8px;
            font-size: 0.95em;
        }

        .copy-feedback {
            color: var(--success-color);
            text-align: center;
            margin-top: 6px;
            font-size: 0.85em;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .copy-feedback.show {
            opacity: 1;
        }

        /* Mobile-specific improvements */
        .mobile-controls {
            position: sticky;
            bottom: 0;
            background: var(--darker-bg);
            padding: 10px;
            border-top: 1px solid var(--border-color);
            z-index: 50;
        }

        /* Touch-friendly planet sizing */
        .touch-planet {
            min-width: 54px;
            min-height: 32px;
            padding: 6px 8px;
            margin: 3px;
        }

        /* Long press indicator */
        .long-press-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(100, 181, 246, 0.2);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .long-press-indicator.active {
            opacity: 1;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.7; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }

        /* Improved mobile menu */
        .mobile-menu {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        /* Better contrast for mobile readability */
        .chart-box {
            color: #fff;
        }

        .sign-label, .house-label {
            background-color: rgba(0, 0, 0, 0.5);
        }

        /* Improved planet container layout */
        .planets-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 3px;
            padding: 3px;
            align-content: start;
            overflow-y: auto;
            max-height: 100%;
        }
        
        .planet {
            margin: 0;
            width: 100%;
            justify-content: center;
            text-align: center;
        }

        /* Responsive adjustments for very small screens */
        @media (max-width: 340px) {
            .chart-container {
                grid-template-rows: repeat(4, minmax(60px, 1fr));
            }
            
            .planet {
                font-size: 0.8em;
                padding: 3px 5px;
                min-height: 26px;
            }
            
            button {
                padding: 6px 8px;
                font-size: 0.85em;
            }
            
            .planets-container {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            }
        }

        /* Tablet and larger screen adjustments */
        @media (min-width: 768px) {
            body {
                padding: 20px;
                font-size: 16px;
            }
            
            .chart-container {
                max-width: 600px;
                grid-template-rows: repeat(4, minmax(90px, 1fr));
            }
            
            .chart-box {
                padding: 5px;
            }
            
            .planet {
                font-size: 0.9em;
                padding: 5px 8px;
                min-height: 30px;
            }
            
            .controls {
                padding: 15px;
            }
            
            #retrograde-panel {
                width: 250px;
                transform: none;
                left: auto;
                top: auto;
            }
            
            .planets-container {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            }
        }

        /* Prevent zoom on focus for mobile */
        @media (max-width: 768px) {
            select, textarea, input {
                font-size: 16px; /* prevents zoom on focus */
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="chart-title" id="chart-main-title">
            <i class="fas fa-star-and-crescent"></i> Interactive South Indian Vedic Astrology Chart
        </div>

        <div class="main-content">
            <div class="chart-container" id="chart-container">
                <div class="chart-box" data-sign="Pisces">
                    <div class="sign-label">Pi</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Pisces"></div>
                </div>
                <div class="chart-box" data-sign="Aries">
                    <div class="sign-label">Ar</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Aries"></div>
                </div>
                <div class="chart-box" data-sign="Taurus">
                    <div class="sign-label">Ta</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Taurus"></div>
                </div>
                <div class="chart-box" data-sign="Gemini">
                    <div class="sign-label">Ge</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Gemini"></div>
                </div>
                <div class="chart-box" data-sign="Aquarius">
                    <div class="sign-label">Aq</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Aquarius"></div>
                </div>
                <div id="central-empty-space">
                    <div class="center-label">South Indian</div>
                    <div class="center-label">Chart Style</div>
                </div>
                <div class="chart-box" data-sign="Cancer">
                    <div class="sign-label">Cn</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Cancer"></div>
                </div>
                <div class="chart-box" data-sign="Capricorn">
                    <div class="sign-label">Cp</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Capricorn"></div>
                </div>
                <div class="chart-box" data-sign="Leo">
                    <div class="sign-label">Le</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Leo"></div>
                </div>
                <div class="chart-box" data-sign="Sagittarius">
                    <div class="sign-label">Sg</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Sagittarius"></div>
                </div>
                <div class="chart-box" data-sign="Scorpio">
                    <div class="sign-label">Sc</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Scorpio"></div>
                </div>
                <div class="chart-box" data-sign="Libra">
                    <div class="sign-label">Li</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Libra"></div>
                </div>
                <div class="chart-box" data-sign="Virgo">
                    <div class="sign-label">Vi</div>
                    <div class="house-label"></div>
                    <div class="planets-container" data-sign="Virgo"></div>
                </div>
            </div>

            <div class="controls-container">
                <div class="controls">
                    <div class="controls-section">
                        <div class="controls-title">
                            <i class="fas fa-globe"></i>
                            <span id="drag-planets-tip">Planet Placement</span>
                            <select id="language-selector">
                                <option value="en">English</option>
                                <option value="te">తెలుగు (Telugu)</option>
                            </select>
                        </div>
                        <div id="planet-bank">
                            <span class="planet Lagna touch-planet" id="Lagna"><span class="planet-symbol">L</span></span>
                            <span class="planet Sun touch-planet" id="Sun"><span class="planet-symbol">Su</span></span>
                            <span class="planet Moon touch-planet" id="Moon"><span class="planet-symbol">Mo</span></span>
                            <span class="planet Mars touch-planet" id="Mars"><span class="planet-symbol">Ma</span></span>
                            <span class="planet Mercury touch-planet" id="Mercury"><span class="planet-symbol">Me</span></span>
                            <span class="planet Jupiter touch-planet" id="Jupiter"><span class="planet-symbol">Ju</span></span>
                            <span class="planet Venus touch-planet" id="Venus"><span class="planet-symbol">Ve</span></span>
                            <span class="planet Saturn touch-planet" id="Saturn"><span class="planet-symbol">Sa</span></span>
                            <span class="planet Rahu touch-planet" id="Rahu"><span class="planet-symbol">Ra</span></span>
                            <span class="planet Ketu touch-planet" id="Ketu"><span class="planet-symbol">Ke</span></span>
                        </div>
                        <p id="drag-lagna-tip" class="controls-tip">
                            <i class="fas fa-lightbulb"></i> Place Lagna in a chart box to define houses and see house keywords.
                        </p>
                    </div>

                    <div class="controls-section">
                        <div class="controls-title">
                            <i class="fas fa-sliders-h"></i>
                            <span>Chart Controls</span>
                        </div>
                        <div class="button-group">
                            <button id="toggle-signs-btn"><i class="fas fa-eye"></i> Hide Signs</button>
                            <button id="toggle-numbers-btn"><i class="fas fa-hashtag"></i> Hide Numbers</button>
                            <button id="clear-chart-btn"><i class="fas fa-trash-alt"></i> Clear Chart</button>
                            <button id="generate-prompt-btn" class="success"><i class="fas fa-robot"></i> Generate AI Prompt</button>
                        </div>
                    </div>

                    <div class="controls-section">
                        <p id="degree-tip-text" class="controls-tip">
                            <i class="fas fa-info-circle"></i> Tap and drag a planet in the chart up or down to adjust its degree.
                        </p>
                    </div>

                    <div id="prompt-container">
                        <textarea id="ai-prompt" readonly placeholder="Generate a prompt to see the chart analysis text here..."></textarea>
                        <button id="copy-prompt-btn" class="success"><i class="fas fa-copy"></i> Copy to Clipboard</button>
                        <div class="copy-feedback" id="copy-feedback">Copied to clipboard!</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mobile-controls">
            <div class="button-group">
                <button id="mobile-reset-btn"><i class="fas fa-trash-alt"></i> Reset</button>
                <button id="mobile-help-btn"><i class="fas fa-question-circle"></i> Help</button>
            </div>
        </div>
    </div>

    <div id="planet-tooltip" class="tooltip"></div>
    <div id="sign-tooltip" class="tooltip"></div>

    <div id="retrograde-panel">
        <div class="panel-planet-name"></div>
        <label>
            <input type="checkbox" id="retrograde-checkbox"> <span id="retrograde-label">Retrograde</span>
        </label>
        <button id="close-retrograde-panel" style="margin-top: 10px;"><i class="fas fa-times"></i> Close</button>
    </div>

    <script>
        // Data structures and initialization
        const signs = ["Aries", "Taurus", "Gemini", "Cancer", "Leo", "Virgo", "Libra", "Scorpio", "Sagittarius", "Capricorn", "Aquarius", "Pisces"];
        const nakshatras = [
            { name: 'Ashwini', range: '0° – 13°20′ Aries', ruler: 'Ketu', symbol: 'Horse Head', deity: 'Ashwini Kumaras', keywords: 'Speed, Healing, Initiative' },
            { name: 'Bharani', range: '13°20′ – 26°40′ Aries', ruler: 'Venus', symbol: 'Yoni', deity: 'Yama', keywords: 'Birth, Death, Transformation' },
            { name: 'Krittika', range: '26°40′ Aries – 10°00′ Taurus', ruler: 'Sun', symbol: 'Knife', deity: 'Agni', keywords: 'Purification, Fire, Determination' },
            { name: 'Rohini', range: '10°00′ – 23°20′ Taurus', ruler: 'Moon', symbol: 'Cart', deity: 'Brahma', keywords: 'Growth, Fertility, Creation' },
            { name: 'Mrigashira', range: '23°20′ Taurus – 6°40′ Gemini', ruler: 'Mars', symbol: 'Deer Head', deity: 'Soma', keywords: 'Searching, Exploration, Curiosity' },
            { name: 'Ardra', range: '6°40′ – 20°00′ Gemini', ruler: 'Rahu', symbol: 'Teardrop', deity: 'Rudra', keywords: 'Transformation, Struggle, Renewal' },
            { name: 'Punarvasu', range: '20°00′ Gemini – 3°20′ Cancer', ruler: 'Jupiter', symbol: 'Quiver of Arrows', deity: 'Aditi', keywords: 'Renewal, Nourishment, Return' },
            { name: 'Pushya', range: '3°20′ – 16°40′ Cancer', ruler: 'Saturn', symbol: 'Cow Udder', deity: 'Brihaspati', keywords: 'Nourishment, Protection, Spirituality' },
            { name: 'Ashlesha', range: '16°40′ – 30°00′ Cancer', ruler: 'Mercury', symbol: 'Serpent', deity: 'Nagas', keywords: 'Intuition, Cunning, Healing' },
            { name: 'Magha', range: '0° – 13°20′ Leo', ruler: 'Ketu', symbol: 'Throne', deity: 'Pitris', keywords: 'Ancestry, Power, Prestige' },
            { name: 'Purva Phalguni', range: '13°20′ – 26°40′ Leo', ruler: 'Venus', symbol: 'Front Legs of Bed', deity: 'Bhaga', keywords: 'Enjoyment, Relaxation, Creativity' },
            { name: 'Uttara Phalguni', range: '26°40′ Leo – 10°00′ Virgo', ruler: 'Sun', symbol: 'Back Legs of Bed', deity: 'Aryaman', keywords: 'Support, Partnership, Nourishment' },
            { name: 'Hasta', range: '10°00′ – 23°20′ Virgo', ruler: 'Moon', symbol: 'Hand', deity: 'Savitar', keywords: 'Skill, Dexterity, Craftsmanship' },
            { name: 'Chitra', range: '23°20′ Virgo – 6°40′ Libra', ruler: 'Mars', symbol: 'Pearl', deity: 'Tvashtri', keywords: 'Beauty, Art, Manifestation' },
            { name: 'Swati', range: '6°40′ – 20°00′ Libra', ruler: 'Rahu', symbol: 'Coral', deity: 'Vayu', keywords: 'Independence, Movement, Flexibility' },
            { name: 'Vishakha', range: '20°00′ Libra – 3°20′ Scorpio', ruler: 'Jupiter', symbol: 'Triumphal Arch', deity: 'Indra & Agni', keywords: 'Determination, Purpose, Achievement' },
            { name: 'Anuradha', range: '3°20′ – 16°40′ Scorpio', ruler: 'Saturn', symbol: 'Lotus', deity: 'Mitra', keywords: 'Friendship, Devotion, Success' },
            { name: 'Jyeshtha', range: '16°40′ – 30°00′ Scorpio', ruler: 'Mercury', symbol: 'Earring', deity: 'Indra', keywords: 'Seniority, Protection, Authority' },
            { name: 'Mula', range: '0° – 13°20′ Sagittarius', ruler: 'Ketu', symbol: 'Roots', deity: 'Nirriti', keywords: 'Foundation, Destruction, Rebirth' },
            { name: 'Purva Ashadha', range: '13°20′ – 26°40′ Sagittarius', ruler: 'Venus', symbol: 'Elephant Tusk', deity: 'Apah', keywords: 'Invincibility, Persistence, Purification' },
            { name: 'Uttara Ashadha', range: '26°40′ Sagittarius – 10°00′ Capricorn', ruler: 'Sun', symbol: 'Elephant Tusk', deity: 'Vishvedevas', keywords: 'Universal Victory, Leadership, Dharma' },
            { name: 'Shravana', range: '10°00′ – 23°20′ Capricorn', ruler: 'Moon', symbol: 'Ear', deity: 'Vishnu', keywords: 'Listening, Learning, Wisdom' },
            { name: 'Dhanishta', range: '23°20′ Capricorn – 6°40′ Aquarius', ruler: 'Mars', symbol: 'Drum', deity: 'Vasus', keywords: 'Wealth, Rhythm, Celebration' },
            { name: 'Shatabhisha', range: '6°40′ – 20°00′ Aquarius', ruler: 'Rahu', symbol: 'Empty Circle', deity: 'Varuna', keywords: 'Healing, Mystery, Revelation' },
            { name: 'Purva Bhadrapada', range: '20°00′ Aquarius – 3°20′ Pisces', ruler: 'Jupiter', symbol: 'Front of Funeral Cot', deity: 'Aja Ekapada', keywords: 'Transformation, Spirituality, Fire' },
            { name: 'Uttara Bhadrapada', range: '3°20′ – 16°40′ Pisces', ruler: 'Saturn', symbol: 'Back of Funeral Cot', deity: 'Ahir Budhnya', keywords: 'Stability, Depth, Transformation' },
            { name: 'Revati', range: '16°40′ – 30°00′ Pisces', ruler: 'Mercury', symbol: 'Fish', deity: 'Pushan', keywords: 'Nourishment, Protection, Completion' }
        ];

        const planetKeywords = {
            Sun: "Authority, Leadership, Ego, Confidence, Soul",
            Moon: "Mind, Emotions, Mother, Nurturing, Feelings",
            Mars: "Energy, Action, Courage, Sibling, Aggression",
            Mercury: "Communication, Intellect, Logic, Analysis, Business",
            Jupiter: "Knowledge, Expansion, Guru, Wisdom, Fortune",
            Venus: "Love, Relationships, Art, Comforts, Beauty",
            Saturn: "Discipline, Karma, Hard work, Longevity, Obstacles",
            Rahu: "Desire, Illusion, Foreign influence, Ambition",
            Ketu: "Spirituality, Detachment, Liberation, Past life, Research",
            Lagna: "Self, Personality, Physical Body, Appearance"
        };

        const planetRulerships = {
            Sun: ["Leo"],
            Moon: ["Cancer"],
            Mars: ["Aries", "Scorpio"],
            Mercury: ["Gemini", "Virgo"],
            Jupiter: ["Sagittarius", "Pisces"],
            Venus: ["Taurus", "Libra"],
            Saturn: ["Capricorn", "Aquarius"],
            Rahu: ["Aquarius"],
            Ketu: ["Scorpio"]
        };

        const houseInfo = {
            1: { name: "1st House (Lagna)", keywords: "Self, Personality, Physical Body, Appearance, Health", naturalKaraka: "Mars" },
            2: { name: "2nd House", keywords: "Wealth, Family, Speech, Food, Resources, Values", naturalKaraka: "Jupiter" },
            3: { name: "3rd House", keywords: "Siblings, Courage, Communication, Short Journeys, Hobbies, Skills", naturalKaraka: "Mars" },
            4: { name: "4th House", keywords: "Mother, Home, Land, Vehicles, Happiness, Education, Inner Peace", naturalKaraka: "Moon" },
            5: { name: "5th House", keywords: "Children, Creativity, Intelligence, Speculation, Romance, Past Life Karma, Discernment", naturalKaraka: "Jupiter" },
            6: { name: "6th House", keywords: "Enemies, Debts, Disease, Service, Daily Routine, Litigation, Obstacles", naturalKaraka: "Mars" },
            7: { name: "7th House", keywords: "Marriage, Partnerships, Business, Spouse, Public Image, Legal Affairs", naturalKaraka: "Venus" },
            8: { name: "8th House", keywords: "Longevity, Research, Occult, Inheritance, Transformation, Sudden Events, Chronic Illness", naturalKaraka: "Saturn" },
            9: { name: "9th House", keywords: "Father, Guru, Dharma, Fortune, Long Journeys, Higher Learning, Spirituality", naturalKaraka: "Sun" },
            10: { name: "10th House", keywords: "Career, Status, Reputation, Public Life, Achievements, Authority", naturalKaraka: "Mercury" },
            11: { name: "11th House", keywords: "Gains, Friends, Hopes, Desires, Elder Siblings, Community, Ambitions", naturalKaraka: "Jupiter" },
            12: { name: "12th House", keywords: "Losses, Expenses, Moksha, Spirituality, Foreign Lands, Hospitals, Isolation", naturalKaraka: "Saturn" }
        };

        const signInfo = {
            Aries: { keywords: "Initiation, Action, Energy, Independence, Drive", ruler: "Mars", element: "Fire", modality: "Cardinal" },
            Taurus: { keywords: "Stability, Accumulation, Sensuality, Persistence, Comfort", ruler: "Venus", element: "Earth", modality: "Fixed" },
            Gemini: { keywords: "Communication, Intellect, Versatility, Curiosity, Duality", ruler: "Mercury", element: "Air", modality: "Dual" },
            Cancer: { keywords: "Nurturing, Emotion, Home, Sensitivity, Security", ruler: "Moon", element: "Water", modality: "Cardinal" },
            Leo: { keywords: "Creativity, Leadership, Confidence, Royalty, Self-expression", ruler: "Sun", element: "Fire", modality: "Fixed" },
            Virgo: { keywords: "Service, Analysis, Health, Detail-oriented, Practicality", ruler: "Mercury", element: "Earth", modality: "Dual" },
            Libra: { keywords: "Harmony, Relationships, Justice, Balance, Diplomacy", ruler: "Venus", element: "Air", modality: "Cardinal" },
            Scorpio: { keywords: "Transformation, Secrecy, Intensity, Regeneration, Mystery", ruler: "Mars", element: "Water", modality: "Fixed" },
            Sagittarius: { keywords: "Philosophy, Exploration, Optimism, Wisdom, Higher knowledge", ruler: "Jupiter", element: "Fire", modality: "Dual" },
            Capricorn: { keywords: "Discipline, Ambition, Structure, Responsibility, Hard work", ruler: "Saturn", element: "Earth", modality: "Cardinal" },
            Aquarius: { keywords: "Innovation, Humanitarianism, Detachment, Community, Originality", ruler: "Saturn", element: "Air", modality: "Fixed" },
            Pisces: { keywords: "Imagination, Spirituality, Compassion, Surrender, Dreaminess", ruler: "Jupiter", element: "Water", modality: "Dual" }
        };

        const translations = {
            en: {
                chartTitle: "Interactive South Indian Vedic Astrology Chart",
                dragPlanetsTip: "Planet Placement",
                dragLagnaTip: "Place Lagna in a chart box to define houses and see house keywords.",
                clearChart: "Clear Chart",
                degreeTip: "Tap and drag a planet in the chart up or down to adjust its degree.",
                generatePrompt: "Generate AI Prompt",
                copyPrompt: "Copy to Clipboard",
                copied: "Copied to clipboard!",
                planet: "Planet",
                nakshatra: "Nakshatra",
                pada: "Pada",
                house: "House",
                houseKeywordsTitle: "House Keywords",
                signKeywordsTitle: "Sign Keywords",
                ruler: "Ruler",
                element: "Element",
                modality: "Modality",
                retrograde: "Retrograde",
                lagna: "Lagna",
                noHouseInfo: "(Place Lagna to see House info)",
                hideSigns: "Hide Signs",
                showSigns: "Show Signs",
                hideNumbers: "Hide Numbers",
                showNumbers: "Show Numbers",
                houseLordship: "House Lordship",
                placementAnalysis: "Placement Analysis",
                signs: {
                    Aries: "Aries", Taurus: "Taurus", Gemini: "Gemini", Cancer: "Cancer", Leo: "Leo", Virgo: "Virgo",
                    Libra: "Libra", Scorpio: "Scorpio", Sagittarius: "Sagittarius", Capricorn: "Capricorn",
                    Aquarius: "Aquarius", Pisces: "Pisces"
                },
                signShort: {
                    Aries: "Ar", Taurus: "Ta", Gemini: "Ge", Cancer: "Cn", Leo: "Le", Virgo: "Vi",
                    Libra: "Li", Scorpio: "Sc", Sagittarius: "Sg", Capricorn: "Cp",
                    Aquarius: "Aq", Pisces: "Pi"
                },
                planets: {
                    Lagna: "Lagna", Sun: "Sun", Moon: "Moon", Mars: "Mars", Mercury: "Mercury",
                    Jupiter: "Jupiter", Venus: "Venus", Saturn: "Saturn", Rahu: "Rahu", Ketu: "Ketu"
                },
                houseNames: {
                    1: "1st House (Lagna)", 2: "2nd House", 3: "3rd House", 4: "4th House", 5: "5th House",
                    6: "6th House", 7: "7th House", 8: "8th House", 9: "9th House", 10: "10th House",
                    11: "11th House", 12: "12th House"
                },
                houseKeywords: {
                    1: "Self, Personality, Physical Body, Appearance, Health",
                    2: "Wealth, Family, Speech, Food, Resources, Values",
                    3: "Siblings, Courage, Communication, Short Journeys, Hobbies, Skills",
                    4: "Mother, Home, Land, Vehicles, Happiness, Education, Inner Peace",
                    5: "Children, Creativity, Intelligence, Speculation, Romance, Past Life Karma, Discernment",
                    6: "Enemies, Debts, Disease, Service, Daily Routine, Litigation, Obstacles",
                    7: "Marriage, Partnerships, Business, Spouse, Public Image, Legal Affairs",
                    8: "Longevity, Research, Occult, Inheritance, Transformation, Sudden Events, Chronic Illness",
                    9: "Father, Guru, Dharma, Fortune, Long Journeys, Higher Learning, Spirituality",
                    10: "Career, Status, Reputation, Public Life, Achievements, Authority",
                    11: "Gains, Friends, Hopes, Desires, Elder Siblings, Community, Ambitions",
                    12: "Losses, Expenses, Moksha, Spirituality, Foreign Lands, Hospitals, Isolation"
                },
                signKeywords: {
                    Aries: "Initiation, Action, Energy, Independence, Drive",
                    Taurus: "Stability, Accumulation, Sensuality, Persistence, Comfort",
                    Gemini: "Communication, Intellect, Versatility, Curiosity, Duality",
                    Cancer: "Nurturing, Emotion, Home, Sensitivity, Security",
                    Leo: "Creativity, Leadership, Confidence, Royalty, Self-expression",
                    Virgo: "Service, Analysis, Health, Detail-oriented, Practicality",
                    Libra: "Harmony, Relationships, Justice, Balance, Diplomacy",
                    Scorpio: "Transformation, Secrecy, Intensity, Regeneration, Mystery",
                    Sagittarius: "Philosophy, Exploration, Optimism, Wisdom, Higher knowledge",
                    Capricorn: "Discipline, Ambition, Structure, Responsibility, Hard work",
                    Aquarius: "Innovation, Humanitarianism, Detachment, Community, Originality",
                    Pisces: "Imagination, Spirituality, Compassion, Surrender, Dreaminess"
                },
                elements: { Fire: "Fire", Earth: "Earth", Air: "Air", Water: "Water" },
                modalities: { Cardinal: "Cardinal", Fixed: "Fixed", Dual: "Dual" },
            },
            te: {
                chartTitle: "ఇంటరాక్టివ్ సౌత్ ఇండియన్ వేదిక జ్యోతిష్య చార్ట్",
                dragPlanetsTip: "గ్రహాల ప్లేస్మెంట్",
                dragLagnaTip: "గృహాలను నిర్వచించడానికి మరియు గృహ కీలకపదాలను చూడటానికి చార్ట్ బాక్స్లో లగ్నాన్ని ఉంచండి.",
                clearChart: "చార్ట్ క్లియర్ చేయి",
                degreeTip: "డిగ్రీ సర్దుబాటు చేయడానికి చార్ట్లోని గ్రహాన్ని పైకి లేదా కిందకు టాప్ చేసి డ్రాగ్ చేయండి.",
                generatePrompt: "AI ప్రాంప్ట్ జనరేట్ చేయి",
                copyPrompt: "క్లిప్బోర్డ్కు కాపీ చేయి",
                copied: "క్లిప్బోర్డ్కు కాపీ చేయబడింది!",
                planet: "గ్రహం",
                nakshatra: "నక్షత్రం",
                pada: "పాదం",
                house: "గృహం",
                houseKeywordsTitle: "గృహ కీలకపదాలు",
                signKeywordsTitle: "రాశి కీలకపదాలు",
                ruler: "అధిపతి",
                element: "భూతం",
                modality: "స్వభావం",
                retrograde: "వక్రి",
                lagna: "లగ్నం",
                noHouseInfo: "(గృహ సమాచారం చూడటానికి లగ్నాన్ని ఉంచండి)",
                hideSigns: "రాశులను దాచు",
                showSigns: "రాశులను చూపించు",
                hideNumbers: "సంఖ్యలను దాచు",
                showNumbers: "సంఖ్యలను చూపించు",
                houseLordship: "గృహాధిపత్యం",
                placementAnalysis: "ప్లేస్మెంట్ విశ్లేషణ",
                signs: {
                    Aries: "మేషం", Taurus: "వృషభం", Gemini: "మిథునం", Cancer: "కర్కాటకం", Leo: "సింహం", Virgo: "కన్య",
                    Libra: "తులా", Scorpio: "వృశ్చికం", Sagittarius: "ధనుస్సు", Capricorn: "మకరం",
                    Aquarius: "కుంభం", Pisces: "మీనం"
                },
                signShort: {
                    Aries: "మే", Taurus: "వృ", Gemini: "మి", Cancer: "క", Leo: "సి", Virgo: "క",
                    Libra: "తు", Scorpio: "వృ", Sagittarius: "ధ", Capricorn: "మ",
                    Aquarius: "కు", Pisces: "మీ"
                },
                planets: {
                    Lagna: "లగ్నం", Sun: "సూర్యుడు", Moon: "చంద్రుడు", Mars: "అంగారకుడు", Mercury: "బుధుడు",
                    Jupiter: "గురువు", Venus: "శుక్రుడు", Saturn: "శని", Rahu: "రాహు", Ketu: "కేతు"
                },
                houseNames: {
                    1: "1వ గృహం (లగ్నం)", 2: "2వ గృహం", 3: "3వ గృహం", 4: "4వ గృహం", 5: "5వ గృహం",
                    6: "6వ గృహం", 7: "7వ గృహం", 8: "8వ గృహం", 9: "9వ గృహం", 10: "10వ గృహం",
                    11: "11వ గృహం", 12: "12వ గృహం"
                },
                houseKeywords: {
                    1: "స్వయం, వ్యక్తిత్వం, భౌతిక శరీరం, రూపం, ఆరోగ్యం",
                    2: "సంపద, కుటుంబం, వాక్కు, ఆహారం, వనరులు, విలువలు",
                    3: "సహోదరులు, ధైర్యం, కమ్యూనికేషన్, చిన్న ప్రయాణాలు, హాబీలు, నైపుణ్యాలు",
                    4: "తల్లి, ఇల్లు, భూమి, వాహనాలు, సంతోషం, విద్య, అంతర్గత శాంతి",
                    5: "పిల్లలు, సృజనాత్మకత, తెలివి, అంచనా, ప్రేమ, పూర్వజన్మ కర్మ, వివేచన",
                    6: "శత్రువులు, అప్పులు, రోగం, సేవ, దైనందిన రూటీన్, లిటిగేషన్, అడ్డంకులు",
                    7: "వివాహం, భాగస్వామ్యాలు, వ్యాపారం, జీవిత భాగస్వామి, పబ్లిక్ ఇమేజ్, లీగల్ వ్యవహారాలు",
                    8: "దీర్ఘాయువు, పరిశోధన, అద్భుత శాస్త్రం, వారసత్వం, రూపాంతరం, అకస్మాత్తుగా సంఘటనలు, దీర్ఘకాలిక అనారోగ్యం",
                    9: "తండ్రి, గురువు, ధర్మం, అదృష్టం, దీర్ఘ ప్రయాణాలు, ఉన్నత విద్య, ఆధ్యాత్మికత",
                    10: "కెరీర్, స్థాయి, ప్రతిష్ఠ, పబ్లిక్ లైఫ్, విజయాలు, అధికారం",
                    11: "లాభాలు, స్నేహితులు, ఆశలు, కోరికలు, పెద్ద సహోదరులు, కమ్యూనిటీ, ఆకాంక్షలు",
                    12: "నష్టాలు, ఖర్చులు, మోక్షం, ఆధ్యాత్మికత, విదేశీ భూములు, ఆసుపత్రులు, ఏకాంతం"
                },
                signKeywords: {
                    Aries: "ప్రారంభం, చర్య, శక్తి, స్వాతంత్ర్యం, డ్రైవ్",
                    Taurus: "స్థిరత్వం, సంచయం, ఇంద్రియ సుఖం, పట్టుదల, సౌకర్యం",
                    Gemini: "కమ్యూనికేషన్, బుద్ధి, బహుముఖ ప్రజ్ఞ, ఉత్సుకత, ద్వంద్వత",
                    Cancer: "పోషణ, భావోద్వేగం, ఇల్లు, సున్నితత్వం, భద్రత",
                    Leo: "సృజనాత్మకత, నాయకత్వం, ఆత్మవిశ్వాసం, రాచరికం, స్వీయ-వ్యక్తీకరణ",
                    Virgo: "సేవ, విశ్లేషణ, ఆరోగ్యం, వివరాలపై దృష్టి, ఆచరణాత్మకత",
                    Libra: "సామరస్యం, సంబంధాలు, న్యాయం, సమతుల్యత, రాయబారం",
                    Scorpio: "రూపాంతరం, రహస్యం, తీవ్రత, పునరుద్ధరణ, రహస్యం",
                    Sagittarius: "తత్వజ్ఞానం, అన్వేషణ, ఆశావాదం, జ్ఞానం, ఉన్నత జ్ఞానం",
                    Capricorn: "శిక్షణ, మహత్వాకాంక్ష, నిర్మాణం, బాధ్యత, కఠిన పని",
                    Aquarius: "నవీనత, మానవతావాదం, వైరాగ్యం, కమ్యూనిటీ, మూలాధారం",
                    Pisces: "కల్పన, ఆధ్యాత్మికత, కరుణ, సమర్పణ, స్వప్నాత్మకత"
                },
                elements: { Fire: "అగ్ని", Earth: "భూమి", Air: "గాలి", Water: "నీరు" },
                modalities: { Cardinal: "చార్", Fixed: "స్థిర", Dual: "ద్వంద్వ" },
            }
        };

        // State management
        let draggedPlanetId = null;
        const planetDegrees = {};
        let initialPlanetBankHTML = '';
        let lagnaSign = null;
        let areSignsHidden = false;
        let areNumbersHidden = false;
        let isChangingDegree = false;
        let degreeChangePlanet = null;
        let initialTouchY = 0;
        let initialPlanetDegree = 0;
        const planetTooltip = document.getElementById('planet-tooltip');
        const signTooltip = document.getElementById('sign-tooltip');
        const retrogradePanel = document.getElementById('retrograde-panel');
        const retrogradeCheckbox = document.getElementById('retrograde-checkbox');
        const panelPlanetName = retrogradePanel.querySelector('.panel-planet-name');
        let selectedPlanetForRetrograde = null;
        let currentLanguage = 'en';
        let isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        let touchStartTime = 0;
        let touchStartX = 0;
        let touchStartY = 0;
        let longPressTimer = null;
        let isDragging = false;
        let activeTouchId = null;
        let dragVisualTimer = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            initialPlanetBankHTML = document.getElementById('planet-bank').innerHTML;
            setupEventListeners();
            updateHouseNumbers();

            const savedLang = localStorage.getItem('chartLanguage');
            if (savedLang && translations[savedLang]) {
                document.getElementById('language-selector').value = savedLang;
                setLanguage(savedLang);
            } else {
                setLanguage('en');
            }

            // Set up button event listeners
            document.getElementById('toggle-signs-btn').addEventListener('click', () => toggleSigns());
            document.getElementById('toggle-numbers-btn').addEventListener('click', () => toggleHouseNumbers());
            document.getElementById('clear-chart-btn').addEventListener('click', () => resetChart());
            document.getElementById('generate-prompt-btn').addEventListener('click', () => generateAIPrompt());
            document.getElementById('copy-prompt-btn').addEventListener('click', () => copyPromptToClipboard());
            document.getElementById('close-retrograde-panel').addEventListener('click', () => hideRetrogradePanel());
            document.getElementById('mobile-reset-btn').addEventListener('click', () => resetChart());
            document.getElementById('mobile-help-btn').addEventListener('click', () => showHelp());
            document.getElementById('language-selector').addEventListener('change', (e) => setLanguage(e.target.value));
            
            // Initialize all planets with touch-planet class for mobile
            document.querySelectorAll('.planet').forEach(planet => {
                planet.classList.add('touch-planet');
            });
        });

        function setupEventListeners() {
            // Set up event delegation for dynamic elements
            document.addEventListener('mousedown', handleMouseDown);
            document.addEventListener('mouseup', handleMouseUp);
            
            // Touch events
            document.addEventListener('touchstart', handleTouchStart, { passive: false });
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
            document.addEventListener('touchcancel', handleTouchEnd);
            
            // Set up event listeners for static elements
            document.querySelectorAll('.chart-box[data-sign]').forEach(box => {
                box.addEventListener('dragover', allowDrop);
                box.addEventListener('drop', dropToChart);
                box.addEventListener('dragleave', removeDragOverHighlight);
            });

            const planetBank = document.getElementById('planet-bank');
            planetBank.addEventListener('dragover', allowDrop);
            planetBank.addEventListener('drop', dropToBank);
            planetBank.addEventListener('dragleave', removeDragOverHighlight);
            
            retrogradeCheckbox.addEventListener('change', toggleRetrograde);
            document.addEventListener('click', handleOutsideClick);
            
            // Add event listeners for sign labels
            document.querySelectorAll('.sign-label').forEach(label => {
                label.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showSignTooltip({target: label});
                });
            });
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('chartLanguage', lang);
            updateUIForLanguage();
        }

        function updateUIForLanguage() {
            const langData = translations[currentLanguage];
            if (!langData) return;

            document.getElementById('chart-main-title').innerHTML = `<i class="fas fa-star-and-crescent"></i> ${langData.chartTitle}`;
            document.getElementById('drag-planets-tip').textContent = langData.dragPlanetsTip;
            document.getElementById('drag-lagna-tip').innerHTML = `<i class="fas fa-lightbulb"></i> ${langData.dragLagnaTip}`;
            document.getElementById('clear-chart-btn').innerHTML = `<i class="fas fa-trash-alt"></i> ${langData.clearChart}`;
            document.getElementById('degree-tip-text').innerHTML = `<i class="fas fa-info-circle"></i> ${langData.degreeTip}`;
            document.getElementById('retrograde-label').textContent = langData.retrograde;
            document.getElementById('generate-prompt-btn').innerHTML = `<i class="fas fa-robot"></i> ${langData.generatePrompt}`;
            document.getElementById('copy-prompt-btn').innerHTML = `<i class="fas fa-copy"></i> ${langData.copyPrompt}`;
            document.getElementById('copy-feedback').textContent = langData.copied;

            const toggleSignsBtn = document.getElementById('toggle-signs-btn');
            toggleSignsBtn.innerHTML = `<i class="fas fa-eye"></i> ${areSignsHidden ? langData.showSigns : langData.hideSigns}`;
            
            const toggleNumbersBtn = document.getElementById('toggle-numbers-btn');
            toggleNumbersBtn.innerHTML = `<i class="fas fa-hashtag"></i> ${areNumbersHidden ? langData.showNumbers : langData.hideNumbers}`;

            document.querySelectorAll('.sign-label').forEach(label => {
                const signName = label.closest('.chart-box').dataset.sign;
                label.textContent = langData.signShort[signName];
            });

            if (selectedPlanetForRetrograde) {
                 panelPlanetName.textContent = `${langData.planet}: ${langData.planets[selectedPlanetForRetrograde.id] || selectedPlanetForRetrograde.id}`;
            }

            updateHouseNumbers();
        }

        function handleMouseDown(e) {
            const planetElement = e.target.closest('.planet');
            if (!planetElement) return;

            if (planetElement.parentElement.classList.contains('planets-container')) {
                e.preventDefault();
                isChangingDegree = true;
                degreeChangePlanet = planetElement;
                initialTouchY = e.clientY;
                initialPlanetDegree = planetDegrees[planetElement.id]?.degree || 0;

                document.addEventListener('mousemove', handleDegreeChangeMouseMove);
                hideAllTooltipsAndPanels();
            }
        }

        function handleTouchStart(e) {
            // Only process the first touch in a multi-touch scenario
            if (activeTouchId !== null) return;
            
            const touch = e.touches[0];
            activeTouchId = touch.identifier;
            
            const targetElement = e.target;
            const planetElement = targetElement.closest('.planet');
            
            // Store initial touch position and time
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
            touchStartTime = Date.now();
            
            // Prevent default to avoid scrolling and other browser behaviors
            if (planetElement || targetElement.closest('.sign-label')) {
                e.preventDefault();
            }
            
            // Handle planet touch
            if (planetElement) {
                planetElement.classList.add('highlighted');
                
                if (planetElement.parentElement.classList.contains('planets-container')) {
                    // Start degree adjustment for planets in chart
                    isChangingDegree = true;
                    degreeChangePlanet = planetElement;
                    initialTouchY = touch.clientY;
                    initialPlanetDegree = planetDegrees[planetElement.id]?.degree || 0;
                    
                    // Show tooltip immediately for touch devices
                    showPlanetTooltip(planetElement);
                    
                    // Set up long press to remove planet
                    longPressTimer = setTimeout(() => {
                        removePlanetFromChart(planetElement);
                    }, 800);
                } else if (planetElement.parentElement.id === 'planet-bank') {
                    // Start drag from planet bank
                    draggedPlanetId = planetElement.id;
                    planetElement.style.opacity = '0.7';
                    hideAllTooltipsAndPanels();
                }
            }
            
            // Handle sign label touch
            if (targetElement.closest('.sign-label')) {
                const signLabel = targetElement.closest('.sign-label');
                showSignTooltip({ target: signLabel });
                
                // Auto-hide after delay
                setTimeout(() => {
                    hideSignTooltip();
                }, 3000);
            }
        }

        function handleTouchMove(e) {
            if (activeTouchId === null) return;
            
            // Find the correct touch
            let touch = null;
            for (let i = 0; i < e.changedTouches.length; i++) {
                if (e.changedTouches[i].identifier === activeTouchId) {
                    touch = e.changedTouches[i];
                    break;
                }
            }
            if (!touch) return;
            
            const deltaX = Math.abs(touch.clientX - touchStartX);
            const deltaY = Math.abs(touch.clientY - touchStartY);
            
            // Cancel long press if user moved significantly
            if (longPressTimer && (deltaX > 15 || deltaY > 15)) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
                isDragging = true;
            }
            
            if (!isChangingDegree || !degreeChangePlanet) return;
            
            e.preventDefault(); // Prevent scrolling while adjusting degree
            
            const deltaYMove = initialTouchY - touch.clientY;
            const degreeChange = deltaYMove / 30; // Less sensitive adjustment (increased from 15 to 30)
            let newDegree = initialPlanetDegree + degreeChange;
            newDegree = Math.max(0, Math.min(29.99, newDegree));

            // Only update if the change is significant (more than 0.1 degree)
            if (Math.abs(newDegree - initialPlanetDegree) > 0.1) {
                if (planetDegrees[degreeChangePlanet.id]) {
                    planetDegrees[degreeChangePlanet.id].degree = parseFloat(newDegree.toFixed(2));
                    updatePlanetDegreeDisplay(degreeChangePlanet);
                    showPlanetTooltip(degreeChangePlanet);
                }
            }
        }

        function handleTouchEnd(e) {
            if (activeTouchId === null) return;
            
            // Find the correct touch
            let touch = null;
            for (let i = 0; i < e.changedTouches.length; i++) {
                if (e.changedTouches[i].identifier === activeTouchId) {
                    touch = e.changedTouches[i];
                    break;
                }
            }
            if (!touch) return;
            
            const targetElement = document.elementFromPoint(touch.clientX, touch.clientY);
            const planetElement = targetElement ? targetElement.closest('.planet') : null;
            
            // Clear long press timer
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }
            
            // Handle single tap on planet (show retrograde panel)
            if (planetElement && !isDragging && !isChangingDegree) {
                const touchDuration = Date.now() - touchStartTime;
                const deltaX = Math.abs(touch.clientX - touchStartX);
                const deltaY = Math.abs(touch.clientY - touchStartY);
                
                // If it was a short tap with minimal movement
                if (touchDuration < 300 && deltaX < 10 && deltaY < 10) {
                    if (planetElement.parentElement.classList.contains('planets-container')) {
                        showRetrogradePanel(planetElement);
                    }
                }
            }
            
            // Remove highlight from all planets
            document.querySelectorAll('.planet').forEach(p => {
                p.classList.remove('highlighted');
                p.style.opacity = '1';
            });
            
            if (isChangingDegree) {
                isChangingDegree = false;
                degreeChangePlanet = null;
            }
            
            // Handle drop for touch devices
            if (draggedPlanetId) {
                const elementAtTouch = document.elementFromPoint(touch.clientX, touch.clientY);
                
                if (elementAtTouch) {
                    const targetContainer = elementAtTouch.closest('.chart-box[data-sign]')?.querySelector('.planets-container') || 
                                          elementAtTouch.closest('#planet-bank');
                    
                    if (targetContainer) {
                        const planetToMove = document.getElementById(draggedPlanetId);
                        if (planetToMove && planetToMove.parentElement !== targetContainer) {
                            if (targetContainer.classList.contains('planets-container')) {
                                dropToChart({ 
                                    preventDefault: () => {}, 
                                    target: targetContainer.parentElement 
                                });
                            } else if (targetContainer.id === 'planet-bank') {
                                dropToBank({ 
                                    preventDefault: () => {}, 
                                    target: targetContainer 
                                });
                            }
                        }
                    }
                }
                draggedPlanetId = null;
            }
            
            isDragging = false;
            activeTouchId = null;
        }

        function handleDegreeChangeMouseMove(e) {
            if (!isChangingDegree || !degreeChangePlanet) return;
            const deltaY = initialTouchY - e.clientY;
            const degreeChange = deltaY / 30; // Less sensitive adjustment (increased from 15 to 30)
            let newDegree = initialPlanetDegree + degreeChange;
            newDegree = Math.max(0, Math.min(29.99, newDegree));

            // Only update if the change is significant (more than 0.1 degree)
            if (Math.abs(newDegree - initialPlanetDegree) > 0.1) {
                if (planetDegrees[degreeChangePlanet.id]) {
                    planetDegrees[degreeChangePlanet.id].degree = parseFloat(newDegree.toFixed(2));
                    updatePlanetDegreeDisplay(degreeChangePlanet);
                    showPlanetTooltip(degreeChangePlanet);
                }
            }
        }

        function handleMouseUp() {
            if (isChangingDegree) {
                isChangingDegree = false;
                degreeChangePlanet = null;
                document.removeEventListener('mousemove', handleDegreeChangeMouseMove);
            }
        }
        
        function removePlanetFromChart(planetElement) {
            const currentContainer = planetElement.parentElement;

            if (currentContainer && currentContainer.classList.contains('planets-container')) {
                currentContainer.removeChild(planetElement);
                document.getElementById('planet-bank').appendChild(planetElement);

                if (planetElement.id === 'Lagna') {
                    lagnaSign = null;
                    updateHouseNumbers();
                }

                delete planetDegrees[planetElement.id];
                updatePlanetDegreeDisplay(planetElement);
                updateRetrogradeSymbol(planetElement);
                hideAllTooltipsAndPanels();
            }
        }

        function allowDrop(e) {
            e.preventDefault();
            let targetElement = e.target.closest('.chart-box[data-sign]') || (e.target.id === 'planet-bank' ? e.target : e.target.closest('#planet-bank'));
            if (targetElement) {
                targetElement.classList.add('drag-over');
                
                // Clear any existing timer
                if (dragVisualTimer) clearTimeout(dragVisualTimer);
                
                // Set timer to remove drag-over class if it gets stuck
                dragVisualTimer = setTimeout(() => {
                    document.querySelectorAll('.drag-over').forEach(el => {
                        el.classList.remove('drag-over');
                    });
                }, 2000);
            }
        }

        function removeDragOverHighlight(e) {
            let targetElement = e.target.closest('.chart-box[data-sign]') || (e.target.id === 'planet-bank' ? e.target : e.target.closest('#planet-bank'));
            if (targetElement) {
                targetElement.classList.remove('drag-over');
            }
        }

        function dropToChart(e) {
            e.preventDefault();
            let targetChartBox = e.target.closest('.chart-box[data-sign]');

            if (!targetChartBox || !draggedPlanetId) return;

            let targetContainer = targetChartBox.querySelector('.planets-container');

            if (!targetContainer) return;

            // Clear all drag-over highlights
            document.querySelectorAll('.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });
            
            hideAllTooltipsAndPanels();

            const planetToMove = document.getElementById(draggedPlanetId);
            if (!planetToMove) return;

            const currentParent = planetToMove.parentElement;

            if (currentParent === targetContainer) return;

            if (draggedPlanetId === 'Lagna') {
                const existingLagna = document.querySelector('.planets-container .Lagna');
                if (existingLagna) {
                    const oldLagnaParent = existingLagna.parentElement;
                    const planetBank = document.getElementById('planet-bank');

                    if (oldLagnaParent !== planetBank) {
                        oldLagnaParent.removeChild(existingLagna);
                        planetBank.appendChild(existingLagna);
                        delete planetDegrees[existingLagna.id];
                        updatePlanetDegreeDisplay(existingLagna);
                        updateRetrogradeSymbol(existingLagna);
                    }
                }
                lagnaSign = targetContainer.dataset.sign;
                updateHouseNumbers();
            }

            if (currentParent && (currentParent.classList.contains('planets-container') || currentParent.id === 'planet-bank')) {
                currentParent.removeChild(planetToMove);
            }

            targetContainer.appendChild(planetToMove);

            const sign = targetContainer.dataset.sign;
            if (!planetDegrees[planetToMove.id]) {
                planetDegrees[planetToMove.id] = {
                    sign: sign,
                    degree: parseFloat((Math.random() * 30).toFixed(2)),
                    isRetrograde: false
                };
            } else {
                planetDegrees[planetToMove.id].sign = sign;
            }
            updatePlanetDegreeDisplay(planetToMove);
            updateRetrogradeSymbol(planetToMove);
        }

        function dropToBank(e) {
            e.preventDefault();
            let targetBank = e.target.id === 'planet-bank' ? e.target : e.target.closest('#planet-bank');

            if (!targetBank || !draggedPlanetId) return;

            // Clear all drag-over highlights
            document.querySelectorAll('.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });
            
            hideAllTooltipsAndPanels();

            const planetToMove = document.getElementById(draggedPlanetId);
            if (!planetToMove) return;

            if (planetToMove.parentElement.id !== 'planet-bank') {
                const currentParent = planetToMove.parentElement;
                if (currentParent && currentParent.classList.contains('planets-container')) {
                    currentParent.removeChild(planetToMove);
                }
                targetBank.appendChild(planetToMove);
                if (planetToMove.id === 'Lagna') {
                    lagnaSign = null;
                    updateHouseNumbers();
                }

                delete planetDegrees[planetToMove.id];
                updatePlanetDegreeDisplay(planetToMove);
                updateRetrogradeSymbol(planetToMove);
            }
        }

        function showPlanetTooltip(planetElement) {
            hideAllTooltipsAndPanels();

            document.querySelectorAll('.planet.hovered-for-tooltip').forEach(el => el.classList.remove('hovered-for-tooltip'));
            planetElement.classList.add('hovered-for-tooltip');

            const planetData = planetDegrees[planetElement.id];
            if (!planetData) {
                hidePlanetTooltip();
                return;
            }

            const langData = translations[currentLanguage];
            const nakData = getNakshatraAndPada(planetData.sign, planetData.degree);
            const lordshipData = getHouseLordships(planetElement.id);

            let tooltipContent = `<span><strong>${langData.planets[planetElement.id] || planetElement.id}</strong></span>`;
            tooltipContent += `<span>${planetData.degree.toFixed(2)}° ${langData.signs[planetData.sign] || planetData.sign}</span>`;
            tooltipContent += `<span>${langData.nakshatra}: ${nakData.nakshatra.name} – ${langData.pada} ${nakData.pada}</span>`;
            if (planetData.isRetrograde) {
                tooltipContent += `<span>(${langData.retrograde})</span>`;
            }

            if (lagnaSign) {
                tooltipContent += `<hr><span><strong>${langData.houseLordship}:</strong></span>`;
                if (lordshipData.length > 0) {
                    tooltipContent += lordshipData.map(lordship => {
                        const houseName = langData.houseNames[lordship.house] || houseInfo[lordship.house].name;
                        const houseKeywordString = (langData.houseKeywords[lordship.house] || houseInfo[lordship.house].keywords).split(',').slice(0, 2).join(', ');
                        return `<span>&nbsp;&nbsp;Lord of ${houseName}</span>`;
                    }).join('');
                } else {
                    tooltipContent += `<span>&nbsp;&nbsp;N/A</span>`;
                }
            }

            planetTooltip.innerHTML = tooltipContent;
            updateTooltipPosition(planetElement, planetTooltip);
            planetTooltip.classList.add('active');
            
            // Auto-hide tooltip on touch devices after 4 seconds
            if (isTouchDevice) {
                setTimeout(() => {
                    if (planetTooltip.classList.contains('active')) {
                        hidePlanetTooltip();
                    }
                }, 4000);
            }
        }

        function updateTooltipPosition(targetElement, tooltipElement) {
            const rect = targetElement.getBoundingClientRect();
            let tooltipLeft = rect.left + (rect.width / 2) - (tooltipElement.offsetWidth / 2);
            let tooltipTop = rect.top - tooltipElement.offsetHeight - 5;

            // Ensure tooltip stays within viewport
            if (tooltipLeft < 5) tooltipLeft = 5;
            if (tooltipLeft + tooltipElement.offsetWidth > window.innerWidth) {
                tooltipLeft = window.innerWidth - tooltipElement.offsetWidth - 5;
            }
            if (tooltipTop < 5) {
                tooltipTop = rect.bottom + 5;
            }

            tooltipElement.style.left = `${tooltipLeft}px`;
            tooltipElement.style.top = `${tooltipTop}px`;
        }

        function getHouseLordships(planetId) {
            if (!lagnaSign || !planetRulerships[planetId]) return [];

            const ruledSigns = planetRulerships[planetId];
            const lordships = ruledSigns.map(ruledSign => {
                const houseNumber = getHouseNumber(ruledSign);
                return {
                    house: houseNumber,
                    keywords: houseInfo[houseNumber].keywords
                };
            });

            return lordships;
        }

        function getHouseNumber(sign) {
            if (!lagnaSign) return null;
            const ascendantIndexInSigns = signs.indexOf(lagnaSign);
            const signIndexInSigns = signs.indexOf(sign);
            return (signIndexInSigns - ascendantIndexInSigns + 12) % 12 + 1;
        }

        function hidePlanetTooltip() {
            planetTooltip.classList.remove('active');
            document.querySelectorAll('.planet.hovered-for-tooltip').forEach(el => el.classList.remove('hovered-for-tooltip'));
        }

        function showSignTooltip(e) {
            if (e.target.classList.contains('hidden')) return;

            hideAllTooltipsAndPanels();

            const signLabel = e.target;
            const chartBox = signLabel.closest('.chart-box[data-sign]');
            if (!chartBox) return;

            const signName = chartBox.dataset.sign;
            const signOriginalData = signInfo[signName];
            const langData = translations[currentLanguage];

            let houseNumber = null;
            if (lagnaSign) {
                houseNumber = getHouseNumber(signName);
            }

            let tooltipContent = `<span><strong>${langData.signs[signName] || signName}</strong></span>`;

            if (houseNumber) {
                tooltipContent += `<span><strong>${langData.house}:</strong> ${langData.houseNames[houseNumber] || houseNumber + " " + langData.house}</span>`;
                tooltipContent += `<span><strong>${langData.houseKeywordsTitle}:</strong> ${langData.houseKeywords[houseNumber] || houseInfo[houseNumber].keywords}</span>`;
            } else {
                tooltipContent += `<span style="color:var(--highlight-color);">${langData.noHouseInfo}</span>`;
            }

            if (signOriginalData) {
                tooltipContent += `<span><strong>${langData.signKeywordsTitle}:</strong> ${langData.signKeywords[signName] || signOriginalData.keywords}</span>`;
                tooltipContent += `<span><strong>${langData.ruler}:</strong> ${signOriginalData.ruler} | <strong>${langData.element}:</strong> ${langData.elements[signOriginalData.element] || signOriginalData.element} | <strong>${langData.modality}:</strong> ${langData.modalities[signOriginalData.modality] || signOriginalData.modality}</span>`;
            }

            signTooltip.innerHTML = tooltipContent;
            updateTooltipPosition(signLabel, signTooltip);
            signTooltip.classList.add('active');
            
            // Auto-hide tooltip on touch devices after 4 seconds
            if (isTouchDevice) {
                setTimeout(() => {
                    if (signTooltip.classList.contains('active')) {
                        hideSignTooltip();
                    }
                }, 4000);
            }
        }

        function hideSignTooltip() {
            signTooltip.classList.remove('active');
        }

        function showRetrogradePanel(clickedPlanet) {
            hideAllTooltipsAndPanels();

            selectedPlanetForRetrograde = clickedPlanet;
            const planetData = planetDegrees[clickedPlanet.id];
            const langData = translations[currentLanguage];

            panelPlanetName.textContent = `${langData.planet}: ${langData.planets[clickedPlanet.id] || clickedPlanet.id}`;
            retrogradeCheckbox.checked = planetData.isRetrograde;

            retrogradePanel.classList.add('active');
        }

        function toggleRetrograde() {
            if (selectedPlanetForRetrograde && planetDegrees[selectedPlanetForRetrograde.id]) {
                const isChecked = retrogradeCheckbox.checked;
                planetDegrees[selectedPlanetForRetrograde.id].isRetrograde = isChecked;
                updateRetrogradeSymbol(selectedPlanetForRetrograde);
                if (planetTooltip.classList.contains('active') && document.querySelector('.planet.hovered-for-tooltip') === selectedPlanetForRetrograde) {
                    showPlanetTooltip(selectedPlanetForRetrograde);
                }
            }
        }

        function updateRetrogradeSymbol(planetElement) {
            let symbolSpan = planetElement.querySelector('.retrograde-symbol');
            if (!symbolSpan) {
                symbolSpan = document.createElement('span');
                symbolSpan.classList.add('retrograde-symbol');
                planetElement.querySelector('.planet-symbol').insertAdjacentElement('afterend', symbolSpan);
            }

            if (planetDegrees[planetElement.id] && planetDegrees[planetElement.id].isRetrograde) {
                symbolSpan.textContent = ' R';
                planetElement.classList.add('retrograde');
            } else {
                symbolSpan.textContent = '';
                planetElement.classList.remove('retrograde');
            }
        }

        function hideRetrogradePanel() {
            retrogradePanel.classList.remove('active');
            selectedPlanetForRetrograde = null;
        }

        function handleOutsideClick(e) {
            if (retrogradePanel.classList.contains('active') &&
                !retrogradePanel.contains(e.target) &&
                !e.target.closest('.planet') &&
                !e.target.closest('.sign-label') &&
                !e.target.closest('#language-selector')) {
                hideRetrogradePanel();
            }
            if (!e.target.closest('.tooltip') && !e.target.closest('.planet') && !e.target.closest('.sign-label') && !e.target.closest('#retrograde-panel') && !e.target.closest('#language-selector')) {
                hideAllTooltipsAndPanels();
            }
        }

        function hideAllTooltipsAndPanels() {
            hidePlanetTooltip();
            hideSignTooltip();
            hideRetrogradePanel();
        }

        function getNakshatraAndPada(sign, degree) {
            const nakshatraLengthDegrees = 13.333333333;
            const padaLengthDegrees = nakshatraLengthDegrees / 4;

            const signIndex = signs.indexOf(sign);
            if (signIndex === -1) {
                return { nakshatra: { name: 'N/A' }, pada: '-' };
            }

            const totalDegrees = (signIndex * 30) + degree;
            let nakshatraNumber = Math.floor(totalDegrees / nakshatraLengthDegrees);

            if (nakshatraNumber >= nakshatras.length) {
                nakshatraNumber = nakshatras.length - 1;
            }

            const foundNakshatra = nakshatras[nakshatraNumber];
            const degreesIntoCurrentNakshatra = totalDegrees % nakshatraLengthDegrees;
            const pada = Math.floor(degreesIntoCurrentNakshatra / padaLengthDegrees) + 1;
            return {
                nakshatra: foundNakshatra,
                pada: pada
            };
        }

        function updatePlanetDegreeDisplay(planetElement) {
            let degreeDisplay = planetElement.querySelector('.planet-degree-display');
            if (!degreeDisplay) {
                degreeDisplay = document.createElement('span');
                degreeDisplay.classList.add('planet-degree-display');
                planetElement.appendChild(degreeDisplay);
            }

            const planetData = planetDegrees[planetElement.id];
            if (planetData) {
                degreeDisplay.textContent = `${planetData.degree.toFixed(2)}°`;
            } else {
                degreeDisplay.textContent = '';
            }
        }

        function resetChart() {
            document.querySelectorAll('.planets-container').forEach(container => {
                Array.from(container.children).forEach(planetEl => {
                    delete planetDegrees[planetEl.id];
                    updatePlanetDegreeDisplay(planetEl);
                    updateRetrogradeSymbol(planetEl);
                });
                container.innerHTML = '';
            });
            document.getElementById('planet-bank').innerHTML = initialPlanetBankHTML;

            lagnaSign = null;
            resetAllPlanetDegrees();
            hideAllTooltipsAndPanels();
            updateHouseNumbers();

            areSignsHidden = false;
            areNumbersHidden = false;
            toggleSigns(true);
            toggleHouseNumbers(true);
            updateUIForLanguage();
            
            // Hide prompt container when resetting chart
            document.getElementById('prompt-container').classList.remove('active');
            
            // Re-add touch-planet class to all planets
            document.querySelectorAll('.planet').forEach(planet => {
                planet.classList.add('touch-planet');
            });
        }

        function resetAllPlanetDegrees() {
            for (const planetId in planetDegrees) {
                delete planetDegrees[planetId];
            }
            document.querySelectorAll('#planet-bank .planet').forEach(planetEl => {
                updatePlanetDegreeDisplay(planetEl);
                updateRetrogradeSymbol(planetEl);
            });
        }

        const chartBoxes = document.querySelectorAll('.chart-box[data-sign]');
        function updateHouseNumbers() {
            chartBoxes.forEach(box => {
                const houseLabel = box.querySelector('.house-label');
                if (lagnaSign) {
                    const houseNumber = getHouseNumber(box.dataset.sign);
                    houseLabel.textContent = `${houseNumber}`;
                } else {
                    houseLabel.textContent = '';
                }
            });
        }

        function toggleSigns(forceShow = false) {
            const signLabels = document.querySelectorAll('.sign-label');
            const toggleBtn = document.getElementById('toggle-signs-btn');
            const langData = translations[currentLanguage];

            if (forceShow) {
                areSignsHidden = false;
            } else {
                areSignsHidden = !areSignsHidden;
            }

            signLabels.forEach(label => {
                if (areSignsHidden) {
                    label.classList.add('hidden');
                } else {
                    label.classList.remove('hidden');
                }
            });

            toggleBtn.innerHTML = `<i class="fas fa-eye"></i> ${areSignsHidden ? langData.showSigns : langData.hideSigns}`;
            hideSignTooltip();
        }

        function toggleHouseNumbers(forceShow = false) {
            const houseLabels = document.querySelectorAll('.house-label');
            const toggleBtn = document.getElementById('toggle-numbers-btn');
            const langData = translations[currentLanguage];

            if (forceShow) {
                areNumbersHidden = false;
            } else {
                areNumbersHidden = !areNumbersHidden;
            }

            houseLabels.forEach(label => {
                if (areNumbersHidden) {
                    label.classList.add('hidden');
                } else {
                    label.classList.remove('hidden');
                }
            });

            toggleBtn.innerHTML = `<i class="fas fa-hashtag"></i> ${areNumbersHidden ? langData.showNumbers : langData.hideNumbers}`;
        }

        function generateAIPrompt() {
            const langData = translations[currentLanguage];
            let promptText = `**Vedic Astrology South Indian Chart Summary:**\n\n`;
            
            // Add Lagna information
            if (lagnaSign) {
                const lagnaHouseNumber = getHouseNumber(lagnaSign);
                promptText += `- **${langData.lagna} (Ascendant):** Placed in ${langData.signs[lagnaSign]} in the ${lagnaHouseNumber}${getOrdinalSuffix(lagnaHouseNumber)} house.\n\n`;
            } else {
                promptText += `- **${langData.lagna} (Ascendant):** Not placed in the chart.\n\n`;
            }
            
            promptText += `**Planetary Placements:**\n\n`;
            
            // Collect all planets that are placed in the chart (not in the bank)
            const placedPlanets = [];
            document.querySelectorAll('.planets-container').forEach(container => {
                Array.from(container.children).forEach(planetEl => {
                    if (planetDegrees[planetEl.id]) {
                        placedPlanets.push(planetEl);
                    }
                });
            });
            
            // Sort planets in traditional order
            const planetOrder = ['Sun', 'Moon', 'Mars', 'Mercury', 'Jupiter', 'Venus', 'Saturn', 'Rahu', 'Ketu'];
            placedPlanets.sort((a, b) => {
                return planetOrder.indexOf(a.id) - planetOrder.indexOf(b.id);
            });
            
            // Add each planet's information
            placedPlanets.forEach(planetEl => {
                const planetData = planetDegrees[planetEl.id];
                const nakData = getNakshatraAndPada(planetData.sign, planetData.degree);
                const houseNumber = getHouseNumber(planetData.sign);
                
                promptText += `- **${langData.planets[planetEl.id] || planetEl.id}:** In ${langData.signs[planetData.sign]}, ${houseNumber}${getOrdinalSuffix(houseNumber)} house. `;
                promptText += `${langData.nakshatra}: ${nakData.nakshatra.name}, ${langData.pada} ${nakData.pada}, at ${planetData.degree.toFixed(2)}°`;
                
                if (planetData.isRetrograde) {
                    promptText += ` (${langData.retrograde})`;
                }
                
                promptText += `.\n`;
            });
            
            promptText += `\n**Analysis Request:**\nBased on this chart, please provide a detailed interpretation of the native's personality, career prospects, and key life themes.`;
            
            // Display the prompt
            const promptTextarea = document.getElementById('ai-prompt');
            promptTextarea.value = promptText;
            
            // Show the prompt container
            document.getElementById('prompt-container').classList.add('active');
            
            // Scroll to the prompt area
            promptTextarea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function getOrdinalSuffix(num) {
            if (num > 3 && num < 21) return 'th';
            switch (num % 10) {
                case 1: return 'st';
                case 2: return 'nd';
                case 3: return 'rd';
                default: return 'th';
            }
        }
        
        function copyPromptToClipboard() {
            const promptTextarea = document.getElementById('ai-prompt');
            promptTextarea.select();
            
            try {
                navigator.clipboard.writeText(promptTextarea.value).then(() => {
                    // Show feedback
                    const feedback = document.getElementById('copy-feedback');
                    feedback.classList.add('show');
                    
                    setTimeout(() => {
                        feedback.classList.remove('show');
                    }, 2000);
                });
            } catch (err) {
                // Fallback for browsers that don't support clipboard API
                document.execCommand('copy');
                
                // Show feedback
                const feedback = document.getElementById('copy-feedback');
                feedback.classList.add('show');
                
                setTimeout(() => {
                    feedback.classList.remove('show');
                }, 2000);
            }
        }
        
        function showHelp() {
            alert("Tap and hold a planet to move it. Tap a planet in the chart to set retrograde status. Drag planets from the bank to the chart boxes.");
        }
    </script>
</body>
</html>
